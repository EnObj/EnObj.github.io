(function(e){function t(t){for(var r,s,i=t[0],l=t[1],c=t[2],u=0,m=[];u<i.length;u++)s=i[u],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&m.push(n[s][0]),n[s]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);d&&d(t);while(m.length)m.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,i=1;i<a.length;i++){var l=a[i];0!==n[l]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=a[0]))}return e}var r={},n={app:0},o=[];function s(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=r,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var d=l;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0923":function(e,t,a){"use strict";a("379b")},"15f5":function(e,t,a){e.exports=a.p+"img/logined.687bce67.svg"},1601:function(e,t,a){"use strict";a("aa17")},1771:function(e,t,a){var r={"./an-login.svg":"1dca","./logined.svg":"15f5","./logo.PNG":"ec7c","./logo.jpg":"b640","./un-login.svg":"a1af"};function n(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=o,e.exports=n,n.id="1771"},"1dca":function(e,t,a){e.exports=a.p+"img/an-login.fce77a4b.svg"},"283a":function(e,t,a){"use strict";a("611a")},"379b":function(e,t,a){},"55ac":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var r=a("2b0e"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("el-row",{attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{xs:24,sm:20,md:16,lg:12}},[a("router-view")],1)],1)],1)},o=[],s={name:"App",data:function(){return{rilis:[{name:"我的减肥的一个月",desc:"这个月我忍着想吃掉一切东西的食欲做到了真正的减肥，结果怎样，拭目以待吧，我将每天更新我的体重在这个日历里面",startDate:"2019-08-20",endDate:"2019-09-19",createTime:1697348183912}]}}},i=s,l=a("2877"),c=Object(l["a"])(i,n,o,!1,null,null,null),d=c.exports,u=a("8c4f"),m=a("d148"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.calendar?a("div",{staticClass:"calendar-item"},[a("div",{staticClass:"calendar-name-container"},[a("el-page-header",{attrs:{content:e.calendar.name,title:e.accessByToken?"管理（需登录）":"首页"},on:{back:function(t){return e.$router.push("/")}}}),e.accessByToken?e._e():a("div",{staticClass:"delete-calendar"},[a("el-button",{attrs:{slot:"reference",type:"default",size:"small",icon:"el-icon-edit"},on:{click:e.editCalendar},slot:"reference"},[e._v("编辑")])],1)],1),a("div",{staticClass:"days"},[e.pageInfo.hasPre?a("div",{staticClass:"day-container"},[a("div",{staticClass:"day",on:{click:e.prePage}},[a("div",{staticClass:"day-blank"},[e._v("P")])])]):e._e(),e._l(e.pagedColoredDays,(function(t){return a("div",{key:t.primaryDay.day,staticClass:"day-container"},[a("div",{staticClass:"day",class:{"day-today":t.primaryDay.day==e.today.day,"day-weekend":6==t.primaryDay.week||0==t.primaryDay.week},style:{background:t.calendarDay&&t.calendarDay.color||"#fff"},on:{click:function(a){return e.touchDay(t.primaryDay.day,t.primaryDay.dayNum)}}},[t.calendarDay?a("div",{staticClass:"day-content",style:{color:t.calendarDay.fontColor||"#000"}},[t.calendarDay.icon?a("i",{staticClass:"icon-content",class:"el-icon-"+t.calendarDay.icon}):a("span",[e._v(e._s(t.calendarDay.content))])]):a("div",{staticClass:"day-blank"},[e._v(" "+e._s(t.primaryDay.day==e.today.day?"今":e.showDaysPageSetting.skip+t.primaryDay.dayNum)+" ")])])])})),e.pageInfo.hasNext?a("div",{staticClass:"day-container"},[a("div",{staticClass:"day",on:{click:e.nextPage}},[a("div",{staticClass:"day-blank"},[e._v("N")])])]):e._e()],2),a("div",{staticClass:"calendar-desc"},[e._v(e._s(e.calendar.desc))]),a("div",{staticClass:"calendar-desc"},[e.calendar.startDay?a("span",[e._v("从"+e._s(e.calendar.startDay))]):e._e(),e.calendar.endDay?a("span",[e._v("至"+e._s(e.calendar.endDay))]):e._e()]),e.accessByToken?e._e():a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("插件：宝贝喝水"),a("span",{staticClass:"not-importent"},[e._v("(beta)")])]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.editBabyDrinkWater}},[e._v("编辑")])],1),e.calendar.babyDrinkWater?a("div",{staticClass:"baby-drink-water"},[a("div",{staticClass:"baby-drink-water-config"},[a("div",{staticClass:"from"},[e._v(e._s(e.calendar.babyDrinkWater.from))]),a("div",{staticClass:"from-to"},[a("i",{staticClass:"el-icon-right"})]),a("div",{staticClass:"to"},[e._v(" "+e._s(e.calendar.babyDrinkWater.to)),a("span",{staticClass:"not-importent"},[e._v("("+e._s(e.calendar.babyDrinkWater.toEmail)+")")])])])]):a("div",[e._v("未启用")])]),e.accessByToken?e._e():a("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[a("el-popconfirm",{attrs:{title:"删除后不可恢复，确定删除吗？"},on:{confirm:e.deleteCalendar}},[a("el-button",{attrs:{slot:"reference",type:"danger",size:"small",icon:"el-icon-delete-solid"},slot:"reference"},[e._v("删除")])],1)],1),a("el-dialog",{attrs:{title:"第"+e.settingCalendarDayForm.dayNum+"天",visible:e.setCalendarDayDialog,width:"350px"},on:{"update:visible":function(t){e.setCalendarDayDialog=t}}},[a("el-form",{attrs:{model:e.settingCalendarDayForm}},[a("el-form-item",{attrs:{label:"日历日期"}},[a("div",[e._v(e._s(e.settingCalendarDayForm.day))])]),a("el-form-item",{attrs:{label:""}},[a("div",[a("el-button",{style:{background:e.settingCalendarDayForm.color||"rgb(0,0,0,0)"},attrs:{type:"primary",icon:"el-icon-"+e.settingCalendarDayForm.icon},on:{click:e.setIcon}},[e._v("状态")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.settingCalendarDayForm.icon,expression:"settingCalendarDayForm.icon"}],attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(t){e.settingCalendarDayForm.icon=""}}},[e._v("清除符号")])],1)]),a("el-form-item",{attrs:{label:"内容"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:50},placeholder:"说点什么...",maxlength:"1500",autofocus:""},model:{value:e.settingCalendarDayForm.content,callback:function(t){e.$set(e.settingCalendarDayForm,"content",t)},expression:"settingCalendarDayForm.content"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.setCalendarDayDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setCalendarDay}},[e._v("就这样")])],1)],1),a("el-dialog",{attrs:{title:"我的状态",visible:e.setIconDialog,width:"350px"},on:{"update:visible":function(t){e.setIconDialog=t}}},[a("div",{staticClass:"icons"},e._l(e.icons,(function(t){return a("div",{key:t,staticClass:"icon",style:{background:e.randomColor,color:e.calcedFontColor},on:{click:function(a){return e.touchIcon(t)}}},[a("div",{staticClass:"icon-c"},[a("i",{class:"el-icon-"+t})])])})),0)]),a("el-dialog",{attrs:{title:"宝贝喝水",visible:e.showBabyDrinkWaterDialog,width:"350px"},on:{"update:visible":function(t){e.showBabyDrinkWaterDialog=t}}},[e.babyDrinkWater?a("el-form",{attrs:{model:e.babyDrinkWater}},[a("el-form-item",{attrs:{label:"发信人署名"}},[a("el-input",{attrs:{placeholder:"请输入署名",type:"text"},model:{value:e.babyDrinkWater.from,callback:function(t){e.$set(e.babyDrinkWater,"from",t)},expression:"babyDrinkWater.from"}})],1),a("el-form-item",{attrs:{label:"收信人称谓"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入称谓"},model:{value:e.babyDrinkWater.to,callback:function(t){e.$set(e.babyDrinkWater,"to",t)},expression:"babyDrinkWater.to"}})],1),a("el-form-item",{attrs:{label:"收信人邮箱"}},[a("el-input",{attrs:{type:"text"},model:{value:e.babyDrinkWater.toEmail,callback:function(t){e.$set(e.babyDrinkWater,"toEmail",t)},expression:"babyDrinkWater.toEmail"}})],1)],1):e._e(),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.removeBabyDrinkWater}},[e._v("删除")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveBabyDrinkWater}},[e._v("保存")])],1)],1),a("el-dialog",{attrs:{title:"编辑日历",visible:e.editCalendarDialog,width:"350px"},on:{"update:visible":function(t){e.editCalendarDialog=t}}},[e.editingCalendarItem?a("CalendarItemForm",{attrs:{calendarItem:e.editingCalendarItem}}):e._e(),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancleEdit}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveEditCalendar}},[e._v("确 定")])],1)],1)],1):e._e()},g=[],y=a("2909"),f=a("5530"),h=a("3835"),b=a("1da1"),v=(a("d81d"),a("7db0"),a("fb6a"),a("99af"),a("caad"),a("2532"),a("4de4"),a("c740"),a("a434"),a("d3b7"),a("96cf"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{attrs:{model:e.calendarItem}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.calendarItem.name,callback:function(t){e.$set(e.calendarItem,"name",t)},expression:"calendarItem.name"}})],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{autocomplete:"off",type:"textarea"},model:{value:e.calendarItem.desc,callback:function(t){e.$set(e.calendarItem,"desc",t)},expression:"calendarItem.desc"}})],1),a("el-form-item",{attrs:{label:"起始日期"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"开始日期"},model:{value:e.calendarItem.startDay,callback:function(t){e.$set(e.calendarItem,"startDay",t)},expression:"calendarItem.startDay"}})],1),a("el-form-item",{attrs:{label:"结束日期"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"结束日期"},model:{value:e.calendarItem.endDay,callback:function(t){e.$set(e.calendarItem,"endDay",t)},expression:"calendarItem.endDay"}})],1)],1)}),D=[],w={props:["calendarItem"]},C=w,k=Object(l["a"])(C,v,D,!1,null,null,null),x=k.exports,_={name:"CalendarItem",props:{id:String},components:{CalendarItemForm:x},data:function(){return{editCalendarDialog:!1,editingCalendarItem:null,calendar:null,babyDrinkWater:null,calendarDays:[],setCalendarDayDialog:!1,settingCalendarDayForm:{},showDaysPageSetting:{skip:0,limit:1e3},today:{},adviceColors:["#ff9999","#99ff66","#ff99ff","#66ffff"],recentColors:[],setIconDialog:!1,selectedIcon:"",calcedFontColor:"",randomColor:"",icons:["camera","s-home","s-opportunity","sunny","cloudy","moon","chicken","sugar","watermelon","grape","lollipop","apple","refrigerator","tableware","coffee-cup","wind-power"],showBabyDrinkWaterDialog:!1}},created:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,r,n,o,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.recentColors=JSON.parse(localStorage.getItem("recentColors")||"[]"),e.today=e.toDayObj(new Date),a=e.$loading(),!e.accessByToken){t.next=12;break}return t.next=6,e.loadCalendarByToken();case 6:return e.calendar=t.sent,t.next=9,e.loadCalendarDayByToken();case 9:e.calendarDays=t.sent,t.next=23;break;case 12:return t.next=14,e.cloud.database().collection("yx_calendar").doc(e.id).get();case 14:return r=t.sent,n=Object(h["a"])(r.data,1),o=n[0],e.calendar=o,t.next=20,e.cloud.database().collection("yx_calendar_day").where({calendarId:e.id}).get();case 20:s=t.sent,i=s.data,e.calendarDays=i;case 23:a.close(),100==e.calendarDays.length&&e.$notify({title:"提示",message:"超过100条的记录未被加载",type:"waning"});case 25:case"end":return t.stop()}}),t)})))()},computed:{primaryDays:function(){var e=[],t=new Date(this.calendarEndDay),a=new Date(this.calendar.startDay),r=1;do{e.unshift(Object(f["a"])(Object(f["a"])({},this.toDayObj(a)),{},{dayNum:r++})),a.setDate(a.getDate()+1)}while(a<=t);return e},coloredDays:function(){var e=this;return this.primaryDays.map((function(t){var a=e.calendarDays.find((function(e){return e.day==t.day}));return{primaryDay:t,calendarDay:a}}))},pagedColoredDays:function(){return this.coloredDays.slice(this.showDaysPageSetting.skip,this.showDaysPageSetting.skip+this.showDaysPageSetting.limit)},pageInfo:function(){return{hasPre:this.pagedColoredDays[this.pagedColoredDays.length-1].primaryDay.day!=this.calendar.startDay,hasNext:this.pagedColoredDays[0].primaryDay.day!=this.calendarEndDay}},calendarEndDay:function(){return this.calendar.endDay||this.today.day},selectableColors:function(){return this.recentColors.map((function(e){return{type:"最近",color:e}})).concat(this.adviceColors.map((function(e){return{type:"建议",color:e}})))},accessByToken:function(){return!!this.$route.query.accessToken}},watch:{"settingCalendarDayForm.color":function(e){!e||this.adviceColors.includes(e)||this.recentColors.includes(e)||(this.recentColors=[e].concat(Object(y["a"])(this.recentColors.filter((function(t){return t!=e})))).slice(0,5))}},methods:{editCalendar:function(){this.editCalendarDialog=!0,this.editingCalendarItem=JSON.parse(JSON.stringify(this.calendar))},cancleEdit:function(){this.editCalendarDialog=!1,this.editingCalendarItem=null},saveEditCalendar:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e.editingCalendarItem),a=Object(f["a"])({},e.editingCalendarItem),delete a._id,delete a._openid,t.next=6,e.cloud.database().collection("yx_calendar").doc(e.editingCalendarItem._id).update(a).catch((function(e){console.error(e)}));case 6:r=t.sent,console.log(r),e.calendar=e.editingCalendarItem,e.cancleEdit();case 10:case"end":return t.stop()}}),t)})))()},removeBabyDrinkWater:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.cloud.database().collection("yx_calendar").doc(e.id).update({babyDrinkWater:e.cloud.database().command.remove()});case 2:e.calendar.babyDrinkWater=e.babyDrinkWater=null,e.showBabyDrinkWaterDialog=!1;case 4:case"end":return t.stop()}}),t)})))()},saveBabyDrinkWater:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.cloud.database().collection("yx_calendar").doc(e.id).update({babyDrinkWater:e.babyDrinkWater});case 2:e.calendar.babyDrinkWater=e.babyDrinkWater,e.showBabyDrinkWaterDialog=!1;case 4:case"end":return t.stop()}}),t)})))()},editBabyDrinkWater:function(){this.babyDrinkWater=JSON.parse(JSON.stringify(this.calendar.babyDrinkWater||{from:"",to:"",toEmail:""})),this.showBabyDrinkWaterDialog=!0},toDayObj:function(e){var t=e.getFullYear(),a=e.getMonth()+1,r=e.getDate(),n=e.getDay(),o=""+a;a<10&&(o="0"+a);var s=""+r;return r<10&&(s="0"+r),{day:t+"-"+o+"-"+s,year:t,month:a,dayOfMonth:r,week:n}},setIcon:function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),a=Math.floor(256*Math.random());this.randomColor="rgb(".concat(e,", ").concat(t,", ").concat(a,")"),this.calcedFontColor=e+t+a<370?"#fff":"#000",this.setIconDialog=!0},touchIcon:function(e){this.settingCalendarDayForm.icon=e,this.settingCalendarDayForm.color=this.randomColor,this.setIconDialog=!1},touchDay:function(e,t){var a=this.calendarDays.find((function(t){return t.day==e}));this.showSettingCalendarDayForm(e,t,a)},showSettingCalendarDayForm:function(e,t,a){this.settingCalendarDayForm={day:e,dayNum:t,content:"",icon:this.selectedIcon||"",color:this.randomColor||this.recentColors[0]||this.adviceColors[0]||"",fontColor:this.calcedFontColor||"#000"},a&&(this.settingCalendarDayForm.content=a.content,this.settingCalendarDayForm.color=a.color,this.settingCalendarDayForm.fontColor=a.fontColor,this.settingCalendarDayForm.icon=a.icon),this.setCalendarDayDialog=!0},setCalendarDay:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,r,n,o,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.calendarDays.findIndex((function(t){return t.day==e.settingCalendarDayForm.day})),!e.accessByToken){t.next=7;break}return t.next=4,e.setCalendarDayByToken();case 4:r=t.sent,t.next=19;break;case 7:if(!(a>=0)){t.next=10;break}return t.next=10,e.cloud.database().collection("yx_calendar_day").doc(e.calendarDays[a]._id).remove();case 10:return t.next=12,e.cloud.database().collection("yx_calendar_day").add(Object(f["a"])(Object(f["a"])({calendarId:e.calendar._id},e.settingCalendarDayForm),{},{createTime:Date.now()}));case 12:return n=t.sent,o=n.id,t.next=16,e.cloud.database().collection("yx_calendar_day").doc(o).get();case 16:s=t.sent,i=s.data,r=i[0];case 19:a>=0&&e.calendarDays.splice(a,1),console.log(r),e.calendarDays.push(r),e.setCalendarDayDialog=!1,e.setIconDialog=!1,e.selectedIcon="";case 25:case"end":return t.stop()}}),t)})))()},prePage:function(){this.showDaysPageSetting.skip-=this.showDaysPageSetting.limit},nextPage:function(){this.showDaysPageSetting.skip+=this.showDaysPageSetting.limit},deleteCalendar:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.cloud.database().collection("yx_calendar").doc(e.calendar._id).remove();case 2:e.$notify({title:"成功",message:"已成功删除此日历",type:"success"}),e.$router.push("/index");case 4:case"end":return t.stop()}}),t)})))()},loadCalendarByToken:function(){return fetch("https://service-i146fyvj-1252108641.sh.apigw.tencentcs.com/release/baby-drink-water",{method:"POST",body:JSON.stringify({action:"yx-get-calendar",data:Object(f["a"])(Object(f["a"])({},this.$route.query),{},{calendarId:this.id})})}).then((function(e){return e.json()})).then((function(e){return e.calendar}))},loadCalendarDayByToken:function(){return fetch("https://service-i146fyvj-1252108641.sh.apigw.tencentcs.com/release/baby-drink-water",{method:"POST",body:JSON.stringify({action:"yx-query-calendar-day",data:Object(f["a"])(Object(f["a"])({},this.$route.query),{},{calendarId:this.id})})}).then((function(e){return e.json()})).then((function(e){return e.calendarDays}))},setCalendarDayByToken:function(){return fetch("https://service-i146fyvj-1252108641.sh.apigw.tencentcs.com/release/baby-drink-water",{method:"POST",body:JSON.stringify({action:"yx-set-calendar-day",data:Object(f["a"])(Object(f["a"])({},this.$route.query),{},{calendarId:this.id,calendarDay:Object(f["a"])({},this.settingCalendarDayForm)})})}).then((function(e){return e.json()})).then((function(e){return e.newCalendarDay}))}},beforeDestroy:function(){localStorage.setItem("recentColors",JSON.stringify(this.recentColors))}},F=_,O=(a("c8c3"),Object(l["a"])(F,p,g,!1,null,"adde1710",null)),j=O.exports,I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"calendar-list"},[a("div",{staticClass:"header"},[a("h1",{staticClass:"app-name"}),a("div",{staticClass:"new-calendar"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-user"},on:{click:function(t){return e.$router.push({path:"/cloud"})}}},[e._v("账户")]),e.loaded&&e.calendars.length?a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-circle-plus"},on:{click:e.newCalendar}},[e._v("新增")]):e._e()],1)]),a("div",{staticClass:"calendars"},e._l(e.calendars,(function(t){return a("div",{key:t._id,staticClass:"calendar",on:{click:function(a){return e.$router.push("/calendar/"+t._id)}}},[a("div",{staticClass:"calendar-left"},[a("CalendarLogo",{attrs:{"calendar-id":t._id}})],1),a("div",{staticClass:"calendar-center"},[a("div",{staticClass:"calendar-name"},[e._v(e._s(t.name))]),a("div",{staticClass:"calendar-desc"},[e._v(e._s(t.desc))]),a("div",{staticClass:"calendar-date-range"},[a("el-tag",{attrs:{size:"small"}},[e._v(e._s(t.startDay)+" ~ "+e._s(t.endDay||"不限"))]),e._v(" "),a("el-tag",{attrs:{size:"small",type:"success"}},[e._v(e._s(t.dayCount)+"天")])],1)]),e._m(0,!0)])})),0),e.loaded&&!e.calendars.length?a("div",{staticClass:"empty-tip"},[e._v(" 啥也没有，现在"),a("el-link",{attrs:{type:"primary"},on:{click:e.newCalendar}},[e._v("新增")]),e._v("一个吧 ")],1):e._e(),a("el-dialog",{attrs:{title:"新增日历",visible:e.setCalendarDialog,width:"350px"},on:{"update:visible":function(t){e.setCalendarDialog=t}}},[a("el-form",{attrs:{model:e.settingCalendarForm}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:e.settingCalendarForm.name,callback:function(t){e.$set(e.settingCalendarForm,"name",t)},expression:"settingCalendarForm.name"}})],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{autocomplete:"off",type:"textarea"},model:{value:e.settingCalendarForm.desc,callback:function(t){e.$set(e.settingCalendarForm,"desc",t)},expression:"settingCalendarForm.desc"}})],1),a("el-form-item",{attrs:{label:"起始日期"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"开始日期"},model:{value:e.settingCalendarForm.startDay,callback:function(t){e.$set(e.settingCalendarForm,"startDay",t)},expression:"settingCalendarForm.startDay"}})],1),a("el-form-item",{attrs:{label:"结束日期"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"结束日期"},model:{value:e.settingCalendarForm.endDay,callback:function(t){e.$set(e.settingCalendarForm,"endDay",t)},expression:"settingCalendarForm.endDay"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.setCalendarDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setCalendar}},[e._v("确 定")])],1)],1)],1)},P=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"calendar-right"},[a("i",{staticClass:"el-icon-arrow-right"})])}],E=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"calendar-logo"},e._l(e.logoCalendarDays,(function(t){return a("div",{key:t._id,staticClass:"calendar-day",style:{background:t.color,color:t.fontColor}},[a("div",{staticClass:"calendar-day-content"},[e._v(" "+e._s(t.contentFirstChar)+" ")])])})),0)},R=[],$={name:"CalendarLogo",props:{calendarId:String},data:function(){return{calendarDays:[]}},created:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.cloud.database().collection("yx_calendar_day").where({calendarId:e.calendarId}).limit(9).get();case 2:a=t.sent,r=a.data,e.calendarDays=r;case 5:case"end":return t.stop()}}),t)})))()},computed:{logoCalendarDays:function(){var e=Object(y["a"])(this.calendarDays);while(e.length<9)e.push({_id:"c"+e.length,content:"",color:"#aaa",fontColor:"#000"});return e.map((function(e){return Object(f["a"])(Object(f["a"])({},e),{},{contentFirstChar:e.content.substr(0,1)})}))}}},S=$,W=(a("1601"),Object(l["a"])(S,E,R,!1,null,"95cc7a20",null)),L=W.exports,T=a("5a0c"),M=a.n(T),B={name:"CalendarList",data:function(){return{calendars:[],setCalendarDialog:!1,settingCalendarForm:{name:"",desc:"",startDay:"",endDay:""},loaded:!1}},components:{CalendarLogo:L},created:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$loading(),t.next=3,e.cloud.database().collection("yx_calendar").get();case 3:r=t.sent,n=r.data,a.close(),e.calendars=n.map((function(e){return e.dayCount=M()().diff(e.startDay,"day")+1,e})),e.loaded=!0;case 8:case"end":return t.stop()}}),t)})))()},methods:{setCalendar:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var a,r,n,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.cloud.database().collection("yx_calendar").add(Object(f["a"])(Object(f["a"])({},e.settingCalendarForm),{},{createTime:Date.now()}));case 2:return a=t.sent,r=a.id,t.next=6,e.cloud.database().collection("yx_calendar").doc(r).get();case 6:n=t.sent,o=Object(h["a"])(n.data,1),s=o[0],e.calendars.push(s),e.setCalendarDialog=!1;case 11:case"end":return t.stop()}}),t)})))()},newCalendar:function(){this.settingCalendarForm={name:"新建日历",desc:"这是一段关于此日历的描述（非必填）",startDay:"2022-01-01",endDay:""},this.setCalendarDialog=!0}}},N=B,A=(a("283a"),Object(l["a"])(N,I,P,!1,null,"a2212d00",null)),q=A.exports,J=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"hello-world"},[r("el-page-header",{attrs:{content:"账户",title:"首页"},on:{back:function(t){return e.$router.push("/")}}}),r("div",{staticClass:"user"},[r("div",{staticClass:"user-icon"},[r("img",{attrs:{src:a("1771")("./"+e.userIcon),alt:"头像"}})]),r("div",{staticClass:"user-name"},[e._v(e._s(e.userName))])]),r("div",{staticClass:"actions"},[r("div",{staticClass:"action"},[e.user.logined&&0!=e.user.loginType?e._e():r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.loginForm.email=e.user.email,e.showLoginDialog=!0}}},[e._v(e._s(e.loginText))])],1),r("div",{staticClass:"action"},[e.user.logined&&0==e.user.loginType&&!e.user.email?r("el-button",{attrs:{type:"info"},on:{click:function(t){e.showSetEmailDialog=!0}}},[e._v("绑定邮箱")]):e._e()],1),r("div",{staticClass:"action"},[e.user.logined?e._e():r("el-button",{attrs:{type:"text",loading:e.loginLoading},on:{click:e.loginAsAnonymous}},[e._v("匿名登录")])],1),r("div",{staticClass:"action"},[e.user.logined?e._e():r("el-button",{attrs:{type:"success"},on:{click:function(t){e.showRegisterDialog=!0}}},[e._v("注册")])],1),r("div",{staticClass:"action"},[e.user.logined&&0!=e.user.loginType?r("el-popconfirm",{attrs:{title:"确定退出登录吗？"},on:{confirm:e.logout}},[r("el-button",{attrs:{slot:"reference",type:"danger",loading:e.logoutLoading},slot:"reference"},[e._v("退出")])],1):e._e()],1)]),r("el-dialog",{attrs:{title:"登录",visible:e.showLoginDialog,width:"350px"},on:{"update:visible":function(t){e.showLoginDialog=t}}},[r("el-form",{ref:"loginForm",attrs:{model:e.loginForm,rules:e.loginRules,"label-width":"60px"}},[r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{attrs:{placeholder:"邮箱","prefix-icon":"el-icon-user"},model:{value:e.loginForm.email,callback:function(t){e.$set(e.loginForm,"email","string"===typeof t?t.trim():t)},expression:"loginForm.email"}})],1),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{placeholder:"密码","prefix-icon":"el-icon-key","show-password":""},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password","string"===typeof t?t.trim():t)},expression:"loginForm.password"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",loading:e.loginLoading},on:{click:e.login}},[e._v(" 登录 ")]),r("el-button",{attrs:{type:"text"},on:{click:e.forgetPassword}},[e._v("忘记密码")])],1)],1)],1),r("el-dialog",{attrs:{title:"绑定邮箱",visible:e.showSetEmailDialog,width:"350px"},on:{"update:visible":function(t){e.showSetEmailDialog=t}}},[r("el-form",{ref:"setEmailForm",attrs:{model:e.setEmailForm,rules:e.setEmailRules,"label-width":"60px"}},[r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{attrs:{placeholder:"邮箱","prefix-icon":"el-icon-user"},model:{value:e.setEmailForm.email,callback:function(t){e.$set(e.setEmailForm,"email","string"===typeof t?t.trim():t)},expression:"setEmailForm.email"}})],1),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{placeholder:"密码","prefix-icon":"el-icon-key","show-password":""},model:{value:e.setEmailForm.password,callback:function(t){e.$set(e.setEmailForm,"password","string"===typeof t?t.trim():t)},expression:"setEmailForm.password"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",loading:e.setEmailLoading},on:{click:e.setEmail}},[e._v(" 确定 ")])],1)],1)],1),r("el-dialog",{attrs:{title:"注册",visible:e.showRegisterDialog,width:"350px"},on:{"update:visible":function(t){e.showRegisterDialog=t}}},[r("el-form",{ref:"registerForm",attrs:{model:e.registerForm,rules:e.registerRules,"label-width":"60px"}},[r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{attrs:{placeholder:"邮箱","prefix-icon":"el-icon-user"},model:{value:e.registerForm.email,callback:function(t){e.$set(e.registerForm,"email","string"===typeof t?t.trim():t)},expression:"registerForm.email"}})],1),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{placeholder:"密码","prefix-icon":"el-icon-key","show-password":""},model:{value:e.registerForm.password,callback:function(t){e.$set(e.registerForm,"password","string"===typeof t?t.trim():t)},expression:"registerForm.password"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"success",loading:e.registerLoading},on:{click:e.register}},[e._v(" 确定 ")])],1)],1)],1),r("el-dialog",{attrs:{title:"重置密码",visible:e.showResetPasswordDialog,width:"350px"},on:{"update:visible":function(t){e.showResetPasswordDialog=t}}},[r("el-form",{ref:"resetPasswordForm",attrs:{model:e.resetPasswordForm,rules:e.resetPasswordRules,"label-width":"60px"}},[r("el-form-item",{attrs:{label:"邮箱",prop:" "}},[r("el-input",{attrs:{placeholder:"邮箱","prefix-icon":"el-icon-user"},model:{value:e.resetPasswordForm.email,callback:function(t){e.$set(e.resetPasswordForm,"email","string"===typeof t?t.trim():t)},expression:"resetPasswordForm.email"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",loading:e.resetPasswordLoading},on:{click:e.resetPassword}},[e._v(" 确定 ")])],1)],1)],1)],1)},U=[],z={name:"EoCloud",props:{msg:String},data:function(){return{user:{email:"",logined:!1,loginType:""},showLoginDialog:!1,loginForm:{email:"",password:""},loginRules:{email:[{required:!0,trigger:"blur"}],password:[{required:!0,trigger:"blur"}]},loginLoading:!1,logoutLoading:!1,showSetEmailDialog:!1,setEmailForm:{email:"",password:""},setEmailRules:{email:[{required:!0,trigger:"blur"}],password:[{required:!0,trigger:"blur"}]},setEmailLoading:!1,showRegisterDialog:!1,registerForm:{email:"",password:""},registerRules:{email:[{required:!0,trigger:"blur"}],password:[{required:!0,trigger:"blur"}]},registerLoading:!1,showResetPasswordDialog:!1,resetPasswordForm:{email:""},resetPasswordRules:{email:[{required:!0,trigger:"blur"}]},resetPasswordLoading:!1}},computed:{userIcon:function(){return this.user.logined?"0"==this.user.loginType?"an-login.svg":"logined.svg":"un-login.svg"},userName:function(){return this.user.logined?"0"==this.user.loginType?"匿名用户":this.user.email:"未登录"},loginText:function(){return(this.user.email?"使用"+this.user.email:"邮箱")+"登录"}},created:function(){var e=this;this.cloudAuth.onLoginStateChanged((function(t){console.log(t),t?(e.user.logined=!0,e.user.loginType="ANONYMOUS"==t.loginType?"0":"1",e.user.email=t.user.email):e.user.logined=!1}))},methods:{login:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loginLoading=!0,t.prev=1,t.next=4,e.$refs.loginForm.validate();case 4:return t.next=6,e.cloudAuth.signInWithEmailAndPassword(e.loginForm.email,e.loginForm.password);case 6:e.showLoginDialog=!1,e.$notify({message:"登录成功",type:"success"}),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](1),e.$notify({message:t.t0.message||"请检查表单",type:"error"});case 13:return t.prev=13,e.loginLoading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,10,13,16]])})))()},logout:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.logoutLoading=!0;try{e.cloudAuth.signOut()}catch(a){e.$notify({message:a.message,type:"error"})}finally{e.logoutLoading=!1}case 2:case"end":return t.stop()}}),t)})))()},loginAsAnonymous:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loginLoading=!0,t.prev=1,t.next=4,e.cloudAuth.anonymousAuthProvider().signIn();case 4:e.showLoginDialog=!1,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](1),e.$notify({message:t.t0.message,type:"error"});case 10:return t.prev=10,e.loginLoading=!1,t.finish(10);case 13:case"end":return t.stop()}}),t,null,[[1,7,10,13]])})))()},setEmail:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.setEmailLoading=!0,t.prev=1,t.next=4,e.cloudAuth.currentUser.updateUsername(e.cloudAuth.currentUser.uid);case 4:return t.next=6,e.cloudAuth.currentUser.updatePassword(e.setEmailForm.password);case 6:return t.next=8,e.cloudAuth.currentUser.updateEmail(e.setEmailForm.email);case 8:e.showSetEmailDialog=!1,e.$notify({message:"验证邮件已发送，请检查邮箱以激活",type:"success"}),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](1),e.$notify({message:t.t0.message,type:"error"});case 15:return t.prev=15,e.setEmailLoading=!1,t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[1,12,15,18]])})))()},register:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.registerLoading=!0,t.prev=1,t.next=4,e.cloudAuth.signUpWithEmailAndPassword(e.registerForm.email,e.registerForm.password);case 4:e.showRegisterDialog=!1,e.$notify({message:"验证邮件已发送，请检查邮箱以激活",type:"success"}),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),e.$notify({message:t.t0.message,type:"error"});case 11:return t.prev=11,e.registerLoading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[1,8,11,14]])})))()},forgetPassword:function(){this.resetPasswordForm.email=this.loginForm.email,this.showResetPasswordDialog=!0},resetPassword:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.resetPasswordLoading=!0,t.prev=1,t.next=4,e.cloudAuth.sendPasswordResetEmail(e.resetPasswordForm.email);case 4:e.showResetPasswordDialog=!1,e.$notify({message:"验证邮件已发送，请检查邮箱以激活",type:"success"}),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),e.$notify({message:t.t0.message,type:"error"});case 11:return t.prev=11,e.resetPasswordLoading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[1,8,11,14]])})))()}}},Y=z,G=(a("0923"),Object(l["a"])(Y,J,U,!1,null,"601b6195",null)),H=G.exports,K=a("5c96"),Q=a.n(K),V=(a("0fae"),r["default"].prototype.cloud=m["a"].init({env:"dev-9g0suwuw61afb9f3"})),X=r["default"].prototype.cloudAuth=V.auth({persistence:"local"});r["default"].use(u["a"]),r["default"].use(Q.a),r["default"].config.productionTip=!1;var Z=[{path:"/",redirect:"/index"},{path:"/index",component:q},{path:"/calendar/:id",component:j,props:!0},{path:"/cloud",component:H,props:!0}],ee=new u["a"]({routes:Z});ee.beforeEach((function(e,t,a){"/cloud"===e.path||X.hasLoginState()||e.query.accessToken?a():a("/cloud")})),new r["default"]({render:function(e){return e(d)},router:ee}).$mount("#app")},"611a":function(e,t,a){},a1af:function(e,t,a){e.exports=a.p+"img/un-login.fe221741.svg"},aa17:function(e,t,a){},b640:function(e,t,a){e.exports=a.p+"img/logo.ebd13d48.jpg"},c8c3:function(e,t,a){"use strict";a("55ac")},ec7c:function(e,t){throw new Error("Module parse failed: Unexpected character '�' (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n(Source code omitted for this binary file)")}});
//# sourceMappingURL=app.b3fd4593.js.map